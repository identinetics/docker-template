#!/usr/bin/env python

# Create a signature claim from the output of `docker inspect'
# Intended usage:
#   docker inspect <image id|name> | create_sig_claim.py > didi.json

import json
import re
import sys

def main():
    metadata = load_image_metadata()
    write_signature_claim(metadata)


def load_image_metadata():
    return json.loads(sys.stdin.read())


def write_signature_claim(metadata):
    try:
        repo_tags = metadata[0]['RepoTags']
        repo_digests = metadata[0]['RepoDigests']
    except (KeyError, IndexError):
        pass
    sig_claim =  {
        "FormatVersion": 1,
        "RepoTags": repo_tags,
        "RepoDigests": repo_digests,
    }
    regex_result = re.search('sha256:(.+)$', repo_digests)
    digest_short = regex_result.group(1)[0:8]

    with open('')
    print(json.dumps(sig_claim, indent=4))


main()